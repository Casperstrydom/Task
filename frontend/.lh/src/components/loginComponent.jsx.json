{
    "sourceFile": "src/components/loginComponent.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1758188834206,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1758188834206,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport \"../main/index.css\";\r\n\r\nconst Login = ({ onLogin, switchToRegister }) => {\r\n  const navigate = useNavigate();\r\n  const [formData, setFormData] = useState({ email: \"\", password: \"\" });\r\n\r\n  // Request Notification permission once\r\n  useEffect(() => {\r\n    if (\"Notification\" in window && Notification.permission !== \"granted\") {\r\n      Notification.requestPermission().then((permission) => {\r\n        console.log(\"Notification permission:\", permission);\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setFormData((prev) => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    try {\r\n      const apiBase = import.meta.env.VITE_API_BASE;\r\n      const res = await fetch(`${apiBase}/auth/login`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(formData),\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (!res.ok) {\r\n        // Only backend errors trigger this\r\n        throw new Error(data.error || \"Login failed. Please check your credentials.\");\r\n      }\r\n\r\n      // ‚úÖ Store JWT only if it exists\r\n      if (data.token) localStorage.setItem(\"token\", data.token);\r\n\r\n      console.log(\"‚úÖ Login successful\", data.user);\r\n\r\n      // Update frontend state\r\n      onLogin(data.user);\r\n\r\n      // Navigate to /home\r\n      navigate(\"/home\");\r\n\r\n      // --- Optional Push Notifications ---\r\n      try {\r\n        if (\"serviceWorker\" in navigator && \"PushManager\" in window) {\r\n          const registration = await navigator.serviceWorker.register(\"/sw.js\");\r\n          let subscription = await registration.pushManager.getSubscription();\r\n          if (!subscription) {\r\n            const vapidPublicKey = import.meta.env.VITE_VAPID_PUBLIC_KEY;\r\n            const convertedKey = urlBase64ToUint8Array(vapidPublicKey);\r\n\r\n            subscription = await registration.pushManager.subscribe({\r\n              userVisibleOnly: true,\r\n              applicationServerKey: convertedKey,\r\n            });\r\n          }\r\n\r\n          await fetch(`${apiBase}/subscribe`, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(subscription),\r\n          });\r\n\r\n          console.log(\"‚úÖ Subscribed for push notifications\");\r\n        }\r\n      } catch (pushErr) {\r\n        // üö® Push errors are optional and won‚Äôt block login\r\n        console.warn(\"‚ùå Push subscription failed:\", pushErr);\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error(\"‚ùå Login error:\", err);\r\n      alert(err.message);\r\n    }\r\n  };\r\n\r\n  // Helper for VAPID key conversion\r\n  function urlBase64ToUint8Array(base64String) {\r\n    const padding = \"=\".repeat((4 - (base64String.length % 4)) % 4);\r\n    const base64 = (base64String + padding).replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n    const rawData = atob(base64);\r\n    return Uint8Array.from([...rawData].map((c) => c.charCodeAt(0)));\r\n  }\r\n\r\n  return (\r\n    <div className=\"futuristic-auth-container\">\r\n      <div className=\"cyber-grid\"></div>\r\n      <div className=\"glowing-orbs\">\r\n        <div className=\"orb orb-1\"></div>\r\n        <div className=\"orb orb-2\"></div>\r\n        <div className=\"orb orb-3\"></div>\r\n      </div>\r\n\r\n      <div className=\"auth-wrapper\">\r\n        <div className=\"auth-card\">\r\n          <div className=\"auth-header\">\r\n            <h1 className=\"cyber-title\">\r\n              <span className=\"cyber-title-text\">NEXUS ACCESS</span>\r\n              <span className=\"cyber-title-cursor pulse\">_</span>\r\n            </h1>\r\n            <p className=\"auth-subtitle\">SECURE SYSTEM ENTRY POINT</p>\r\n          </div>\r\n\r\n          <form className=\"cyber-form\" onSubmit={handleSubmit}>\r\n            <div className=\"form-header\">\r\n              <h2 className=\"neon-text\">USER LOGIN</h2>\r\n              <div className=\"form-indicator\"></div>\r\n            </div>\r\n\r\n            <div className=\"input-group\">\r\n              <label className=\"input-label\">IDENTITY</label>\r\n              <input\r\n                type=\"email\"\r\n                name=\"email\"\r\n                value={formData.email}\r\n                onChange={handleChange}\r\n                className=\"cyber-input\"\r\n                placeholder=\"ENTER YOUR EMAIL\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className=\"input-group\">\r\n              <label className=\"input-label\">PASSPHRASE</label>\r\n              <input\r\n                type=\"password\"\r\n                name=\"password\"\r\n                value={formData.password}\r\n                onChange={handleChange}\r\n                className=\"cyber-input\"\r\n                placeholder=\"ENTER YOUR PASSWORD\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className=\"form-options\">\r\n              <label className=\"cyber-checkbox-container\">\r\n                <input type=\"checkbox\" />\r\n                <span className=\"checkmark\"></span>\r\n                REMEMBER ME\r\n              </label>\r\n              <a href=\"#\" className=\"cyber-link\">\r\n                FORGOT PASSPHRASE?\r\n              </a>\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              className=\"cyber-button cyber-button-primary full-width\"\r\n            >\r\n              <span className=\"cyber-button-glitch\">‚ü≥</span>\r\n              <span className=\"cyber-button-text\">ACCESS SYSTEM</span>\r\n            </button>\r\n\r\n            <div className=\"auth-switch\">\r\n              <span>NEW USER?</span>\r\n              <button\r\n                type=\"button\"\r\n                onClick={switchToRegister}\r\n                className=\"cyber-link\"\r\n              >\r\n                REQUEST ACCESS\r\n              </button>\r\n            </div>\r\n          </form>\r\n\r\n          <div className=\"auth-footer\">\r\n            <p>NEXUS SECURITY SYSTEM v2.4.7</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"
        }
    ]
}